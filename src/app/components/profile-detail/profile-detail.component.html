<div class="profile-detail-container">
  <div *ngIf="isLoading" class="loading-state">
    <app-custom-spinner></app-custom-spinner>
  </div>

  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>
  <div *ngIf="profile && !isLoading" class="profile-content">
    <div class="profile-top-section">
      <!-- Profile Picture Section -->
      <div class="profile-picture-section">
        <div class="profile-picture">
          <img [src]="profile.profilePicture" [alt]="profile.fullName">
        </div>
      </div>

      <div class="profile-right-section">

        <!-- Header Section -->
        <div class="profile-header">
          <div class="editable-field" (click)="startEditing('fullName')" *ngIf="profile">
            <h1 *ngIf="editingState.fieldName !== 'fullName'">{{profile.fullName || 'Enter your full name'}}</h1>
            <div *ngIf="editingState.fieldName === 'fullName'" class="edit-controls">
              <input type="text" [(ngModel)]="editingState.currentValue" placeholder="Enter your full name" (keyup.enter)="saveField('fullName')" (keyup.escape)="cancelEditing()">
              <div class="edit-buttons">
                <button (click)="saveField('fullName')" class="save-btn">Save</button>
                <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
              </div>
            </div>
          </div>

          <p class="username">
              {{  '@' + profile.username}}
            <i *ngIf="profile.verified" class="fas fa-gem verified-badge"><i class="fas fa-check verified-badge"></i></i>
          </p>
          <p class="birthday" *ngIf="profile.birthdate">Age: {{formatBirthday(profile.birthdate)}}</p>
            <div class="bio" (click)="startEditing('bio')" *ngIf="profile">
              <p *ngIf="editingState.fieldName !== 'bio'">Bio: <span>{{profile.bio || 'Add a bio to tell people about yourself'}}</span></p>
              <div *ngIf="editingState.fieldName === 'bio'" class="edit-controls">
                <textarea [(ngModel)]="editingState.currentValue" (keyup.enter)="saveField('bio')" (keyup.escape)="cancelEditing()"></textarea>
                <div class="edit-buttons">
                  <button (click)="saveField('bio')" class="save-btn">Save</button>
                  <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
                </div>
              </div>
            </div>

          <div class="upgrade-banner" *ngIf="isCurrentUser && profile.profileLevel === 'standard'">
            <div class="banner-content">
              <i class="fas fa-crown"></i>
              <div class="banner-text">
                <strong>Upgrade to Premium</strong>
                <span>Get more visibility and features</span>
              </div>
              <a routerLink="/pricing" class="upgrade-button">Upgrade Now</a>
            </div>
          </div>

        </div>
      </div>
      <div>
        
      <div class="profile-badges">
        <span class="badge level" [ngClass]="{
          'level-standard': profile.profileLevel.toLowerCase() === 'standard',
          'level-premium': profile.profileLevel.toLowerCase() === 'premium',
          'level-vip': profile.profileLevel.toLowerCase() === 'vip'
        }">
          {{profile.profileLevel}}
          <i *ngIf="profile.profileLevel.toLowerCase() === 'vip'" class="fas fa-star vip-star"></i>
        </span>
        <span class="badge status" [ngClass]="{
          'status-active': profile.status === 'active',
          'status-suspended': profile.status === 'suspended',
          'status-pending': profile.status === 'pending'
        }">{{profile.status}}</span>
        <span *ngIf="isCurrentUser" class="badge settings" routerLink="/settings"><i class="fas fa-magic"></i></span>

      </div>
      <div class="like-buttons-section">
        <button (click)="addUserLike()" class="like-button user-like">
          <i class="fas fa-heart"></i>
          <span>{{profile.userlikes || 0}}</span>
        </button>
        <button (click)="addViewerLike()" class="like-button viewer-like">
          <i class="fas fa-eye"></i>
          <span>{{profile.viewerlikes || 0}}</span>
        </button>
      </div>
    </div>
    </div>

    <!-- Image Gallery -->
    <div class="image-gallery">
      <div class="main-images" *ngIf="profile.images.length">
        <div class="gallery-item" *ngFor="let image of profile.images">
          <img [src]="image" [alt]="profile.fullName" (click)="openImageModal(image)">
        </div>
      </div>
      <div class="videos" *ngIf="profile.videos.length">
        <div class="gallery-item" *ngFor="let video of profile.videos">
          <video controls>
            <source [src]="video" type="video/mp4">
          </video>
        </div>
      </div>
    </div>

    <!-- Bio Section -->
    <div class="bio-section">
      <h2>Roles</h2>
      <div class="role-tags">
        <span class="role-tag" *ngFor="let r of (profile.role || ['onenight'])">{{r}}</span>
      </div>
    </div>

    <!-- Services Section -->
    <div class="services-section">
      <h2>Services</h2>
      <div class="services-container">
        <table class="services-table">
          <thead>
            <tr>
              <th>Services</th>
              <th>Type</th>
              <th>Price</th>
            </tr>
          </thead>
          <tbody>
            <!-- Show included services -->
            <tr *ngFor="let service of getIncludedServices()">
              <td>{{service}}</td>
              <td>Included</td>
              <td>-</td>
            </tr>
            <!-- Show extra services with prices -->
            <tr *ngFor="let item of getExtraServices()">
              <td>{{item.service}}</td>
              <td>Extra</td>
              <td>{{item.price}} {{rates.currency}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Physical Attributes -->
    <div class="attributes-section" *ngIf="profile.physicalAttributes">
      <h2>Physical Attributes</h2>
      <div class="attributes-grid">
        <!-- Gender -->
        <div class="attribute">
          <span class="label">Gender:</span>
          <span class="value">{{profile.physicalAttributes.gender || 'Not specified'}}</span>
        </div>

        <!-- Height -->
        <div class="attribute">
          <span class="label">Height:</span>
          <span class="value">{{profile.physicalAttributes.height ? profile.physicalAttributes.height + ' cm' : 'Not specified'}}</span>
        </div>

        <!-- Weight -->
        <div class="attribute">
          <span class="label">Weight:</span>
          <span class="value">{{profile.physicalAttributes.weight ? profile.physicalAttributes.weight + ' kg' : 'Not specified'}}</span>
        </div>

        <!-- Ethnicity -->
        <div class="attribute">
          <span class="label">Ethnicity:</span>
          <span class="value">{{profile.physicalAttributes.ethnicity || 'Not specified'}}</span>
        </div>

        <!-- Bust Size -->
        <div class="attribute">
          <span class="label">Bust Size:</span>
          <span class="value">{{profile.physicalAttributes.bustSize || 'Not specified'}}</span>
        </div>

        <!-- Bust Type -->
        <div class="attribute">
          <span class="label">Bust Type:</span>
          <span class="value">{{profile.physicalAttributes.bustType || 'Not specified'}}</span>
        </div>

        <!-- Pubic Hair -->
        <div class="attribute">
          <span class="label">Pubic Hair:</span>
          <span class="value">{{profile.physicalAttributes.pubicHair || 'Not specified'}}</span>
        </div>

        <!-- Tattoos & Piercings -->
        <div class="attribute features">
          <span class="label">Features:</span>
          <span class="value">
            <span *ngIf="profile.physicalAttributes.tattoos">Has Tattoos</span>
            <span *ngIf="profile.physicalAttributes.tattoos && profile.physicalAttributes.piercings"> & </span>
            <span *ngIf="profile.physicalAttributes.piercings">Has Piercings</span>
            <span *ngIf="!profile.physicalAttributes.tattoos && !profile.physicalAttributes.piercings">None</span>
          </span>
        </div>
      </div>
    </div>

    <!-- Availability Section -->
    <div class="availability-section" *ngIf="profile.availableToMeet">
      <h2>Availability</h2>
      <div class="availability-details">
        <p *ngIf="profile.availableToMeet.available24_7">Available 24/7</p>
        <p *ngIf="profile.availableToMeet.advanceBooking">Advance Booking Available</p>
        <div *ngIf="profile.availableToMeet.meetingWith.length">
          <h3>Meeting With:</h3>
          <ul>
            <li *ngFor="let meetWith of profile.availableToMeet.meetingWith">{{meetWith}}</li>
          </ul>
        </div>
        <p *ngIf="profile.workingTime">Working Hours: {{profile.workingTime}}</p>
      </div>
    </div>

    <!-- Contact Information -->
    <div class="contact-section">
      <h2>Contact Information</h2>
      <div class="contact-details">
        <div class="contact-item editable-field" (click)="startEditing('contact.phone')">
          <i class="fas fa-phone contact-icon"></i>
          <span class="label">Phone:</span>
          <span *ngIf="editingState.fieldName !== 'contact.phone'" class="value">
            {{profile.contact?.phone || 'Add your phone number'}}
          </span>
          <div *ngIf="editingState.fieldName === 'contact.phone'" class="edit-controls">
            <input type="tel" [(ngModel)]="editingState.currentValue" placeholder="Enter phone number">
            <div class="edit-buttons">
              <button (click)="saveField('contact.phone')" class="save-btn">Save</button>
              <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
            </div>
          </div>
        </div>

        <div class="contact-item editable-field" (click)="startEditing('contact.country')">
          <i class="fas fa-globe contact-icon"></i>
          <span class="label">Country:</span>
          <span *ngIf="editingState.fieldName !== 'contact.country'" class="value">
            {{profile.contact?.country || 'Add your country'}}
          </span>
          <div *ngIf="editingState.fieldName === 'contact.country'" class="edit-controls">
            <input type="text" [(ngModel)]="editingState.currentValue" placeholder="Enter country">
            <div class="edit-buttons">
              <button (click)="saveField('contact.country')" class="save-btn">Save</button>
              <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
            </div>
          </div>
        </div>

        <div class="contact-item editable-field" (click)="startEditing('contact.city')">
          <i class="fas fa-city contact-icon"></i>
          <span class="label">City:</span>
          <span *ngIf="editingState.fieldName !== 'contact.city'" class="value">
            {{profile.contact?.city || 'Add your city'}}
          </span>
          <div *ngIf="editingState.fieldName === 'contact.city'" class="edit-controls">
            <input type="text" [(ngModel)]="editingState.currentValue" placeholder="Enter city">
            <div class="edit-buttons">
              <button (click)="saveField('contact.city')" class="save-btn">Save</button>
              <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
            </div>
          </div>
        </div>

        <div class="contact-item editable-field" (click)="startEditing('email')">
          <i class="fas fa-envelope contact-icon"></i>
          <span class="label">Email:</span>
          <span *ngIf="!isEditing('email')" class="value">{{ profile.email }}</span>
          <div *ngIf="isEditing('email')" class="edit-controls">
            <input type="email" [(ngModel)]="editingState.currentValue" placeholder="Enter email">
            <div class="edit-buttons">
              <button class="save-btn" (click)="saveField('email')">Save</button>
              <button class="cancel-btn" (click)="cancelEditing()">Cancel</button>
            </div>
          </div>
        </div>

        <div class="contact-item editable-field" (click)="startEditing('contact.whatsapp')">
          <i class="fab fa-whatsapp contact-icon"></i>
          <span class="label">WhatsApp:</span>
          <span *ngIf="!isEditing('contact.whatsapp')" class="value">
            {{ profile.contact?.whatsapp || 'Not provided' }}
          </span>
          <div *ngIf="isEditing('contact.whatsapp')" class="edit-controls">
            <div class="whatsapp-edit-wrapper">
              <input type="text" 
                [(ngModel)]="editingState.currentValue" 
                placeholder="Enter country code first (e.g., +357 for Cyprus)"
                title="Start with country code: +357 for Cyprus, +1 for US, +44 for UK">
              <small class="hint-text">Include country code (e.g., +357 12345678)</small>
              <label class="use-phone-checkbox">
                <input type="checkbox" [(ngModel)]="usePhoneForWhatsapp"> Use phone number
              </label>
            </div>
            <div class="edit-buttons">
              <button class="save-btn" (click)="saveField('contact.whatsapp')">Save</button>
              <button class="cancel-btn" (click)="cancelEditing()">Cancel</button>
            </div>
          </div>
        </div>

        <!-- Show WhatsApp link if number exists -->
        <div *ngIf="profile.contact?.whatsapp" class="contact-item">
          <a [href]="getWhatsAppLink()" target="_blank" rel="noopener" class="whatsapp-link">
            <i class="fab fa-whatsapp"></i>
            <span>Chat on WhatsApp</span>
          </a>
        </div>

      </div>
    </div>

    <!-- Additional Information -->
    <div class="additional-info">
      <div class="rates" *ngIf="rates">
        <h2>Rates</h2>
        <div class="rates-header">
          <select [(ngModel)]="selectedCurrency" (change)="updateCurrency()" *ngIf="isCurrentUser">
            <option value="EUR">EUR</option>
            <option value="USD">USD</option>
            <option value="GBP">GBP</option>
          </select>
        </div>
        <table class="rates-table">
          <thead>
            <tr>
              <th>Duration</th>
              <th>Incall</th>
              <th>Outcall</th>
              <th *ngIf="isCurrentUser">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let duration of getRateDurations()">
              <td>{{duration}}</td>
              <td class="editable-field" (click)="startEditing('rates.incall.' + duration)">
                <span *ngIf="editingState.fieldName !== 'rates.incall.' + duration">
                  {{ rates.incall[duration] ? rates.incall[duration] + ' ' + (rates.currency || 'EUR') : 'N/A' }}
                </span>
                <div *ngIf="editingState.fieldName === 'rates.incall.' + duration" class="edit-controls">
                  <input type="number" [(ngModel)]="editingState.currentValue" placeholder="Enter rate" min="0">
                  <div class="edit-buttons">
                    <button (click)="saveField('rates.incall.' + duration)" class="save-btn">Save</button>
                    <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
                  </div>
                </div>
              </td>
              <td class="editable-field" (click)="startEditing('rates.outcall.' + duration)">
                <span *ngIf="editingState.fieldName !== 'rates.outcall.' + duration">
                  {{ rates.outcall[duration] ? rates.outcall[duration] + ' ' + (rates.currency || 'EUR') : 'N/A' }}
                </span>
                <div *ngIf="editingState.fieldName === 'rates.outcall.' + duration" class="edit-controls">
                  <input type="number" [(ngModel)]="editingState.currentValue" placeholder="Enter rate" min="0">
                  <div class="edit-buttons">
                    <button (click)="saveField('rates.outcall.' + duration)" class="save-btn">Save</button>
                    <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
                  </div>
                </div>
              </td>
              <td *ngIf="isCurrentUser">
                <button class="delete-btn" (click)="deleteRate(duration)"><i class="fas fa-trash"></i></button>
              </td>
            </tr>
          </tbody>
        </table>
        <div *ngIf="isCurrentUser" class="add-rate-section">
          <input type="text" [(ngModel)]="newDuration" placeholder="Duration (e.g., '2 Hours')">
          <button (click)="addNewRate()" class="add-btn">Add Rate</button>
        </div>
      </div>
    </div>
  </div>


  <!-- Add this at the bottom of your component -->
  <div class="image-modal" *ngIf="selectedImage" (click)="closeImageModal()">
    <div class="modal-content">
      <span class="close-button" (click)="closeImageModal()">&times;</span>
      <img [src]="selectedImage" alt="Full size image">
    </div>
  </div>
</div>
