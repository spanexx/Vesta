<div class="profile-detail-container">
  <div *ngIf="isLoading" class="loading-state">
    <app-custom-spinner></app-custom-spinner>
  </div>

  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>
  <div *ngIf="profile && !isLoading" class="profile-content">
    <div class="profile-top-section">
      <!-- Profile Picture Section -->
      <div class="profile-picture-section">
        <div class="profile-picture">
          <img [src]="profile.profilePicture" [alt]="profile.fullName">
        </div>
      </div>

      <div class="profile-right-section">

        <!-- Header Section -->
        <div class="profile-header">
          <div class="editable-field" (click)="startEditing('fullName')" *ngIf="profile">
            <h1 *ngIf="editingState.fieldName !== 'fullName'">{{profile.fullName || 'Enter your full name'}}</h1>
            <div *ngIf="editingState.fieldName === 'fullName'" class="edit-controls">
              <input type="text" [(ngModel)]="editingState.currentValue" placeholder="Enter your full name" (keyup.enter)="saveField('fullName')" (keyup.escape)="cancelEditing()">
              <div class="edit-buttons">
                <button (click)="saveField('fullName')" class="save-btn">Save</button>
                <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
              </div>
            </div>
          </div>

          <p class="username">
              {{  '@' + profile.username}}
            <i *ngIf="profile.verified" class="fas fa-gem verified-badge"><i class="fas fa-check verified-badge"></i></i>
          </p>
          <p class="birthday" *ngIf="profile.birthdate">Age: {{formatBirthday(profile.birthdate)}}</p>
            <div class="bio" (click)="startEditing('bio')" *ngIf="profile">
              <p *ngIf="editingState.fieldName !== 'bio'">Bio: <span>{{profile.bio || 'Add a bio to tell people about yourself'}}</span></p>
              <div *ngIf="editingState.fieldName === 'bio'" class="edit-controls">
                <textarea [(ngModel)]="editingState.currentValue" (keyup.enter)="saveField('bio')" (keyup.escape)="cancelEditing()"></textarea>
                <div class="edit-buttons">
                  <button (click)="saveField('bio')" class="save-btn">Save</button>
                  <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
                </div>
              </div>
            </div>

        </div>
      </div>
      <div>
        
      <div class="profile-badges">
        <span class="badge level" [ngClass]="{
          'level-standard': profile.profileLevel.toLowerCase() === 'standard',
          'level-premium': profile.profileLevel.toLowerCase() === 'premium',
          'level-vip': profile.profileLevel.toLowerCase() === 'vip'
        }">
          {{profile.profileLevel}}
          <i *ngIf="profile.profileLevel.toLowerCase() === 'vip'" class="fas fa-star vip-star"></i>
        </span>
        <span class="badge status" [ngClass]="{
          'status-active': profile.status === 'active',
          'status-suspended': profile.status === 'suspended',
          'status-pending': profile.status === 'pending'
        }">{{profile.status}}</span>
        <span *ngIf="isCurrentUser" class="badge settings" routerLink="/settings"><i class="fas fa-magic"></i></span>

      </div>
      <div class="like-buttons-section">
        <button (click)="addUserLike()" class="like-button user-like">
          <i class="fas fa-heart"></i>
          <span>{{profile.userlikes || 0}}</span>
        </button>
        <button (click)="addViewerLike()" class="like-button viewer-like">
          <i class="fas fa-eye"></i>
          <span>{{profile.viewerlikes || 0}}</span>
        </button>
      </div>
    </div>
    </div>

    <!-- Image Gallery -->
    <div class="image-gallery">
      <div class="main-images" *ngIf="profile.images.length">
        <div class="gallery-item" *ngFor="let image of profile.images">
          <img [src]="image" [alt]="profile.fullName" (click)="openImageModal(image)">
        </div>
      </div>
      <div class="videos" *ngIf="profile.videos.length">
        <div class="gallery-item" *ngFor="let video of profile.videos">
          <video controls>
            <source [src]="video" type="video/mp4">
          </video>
        </div>
      </div>
    </div>

    <!-- Bio Section -->
    <div class="bio-section">
      <h2>Roles</h2>
      <div class="editable-field" (click)="startEditing('role')">
        <span class="label">Current Roles:</span>
        <span *ngIf="editingState.fieldName !== 'role'" class="role-tags">
          <span class="role-tag" *ngFor="let r of (profile.role || [])">{{r}}</span>
        </span>
        <div *ngIf="editingState.fieldName === 'role'" class="edit-controls checkbox-grid">
          <label *ngFor="let roleOption of availableRoles">
            <input type="checkbox" 
                   [ngModel]="roleSelections[roleOption.value]"
                   (ngModelChange)="roleSelections[roleOption.value] = $event; updateRoleSelections()">
            {{roleOption.label}}
          </label>
          <div class="edit-buttons">
            <button (click)="saveField('role')" class="save-btn">Save</button>
            <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Services Section -->
    <div class="services-section">
      <h2>Services</h2>
      <div class="editable-field" (click)="startEditingServices()">
        <div *ngIf="editingState.fieldName !== 'services'" class="services-table-container">
          <table class="services-table">
            <thead>
              <tr>
                <th>Services</th>
                <th>Included</th>
                <th>Extra</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let service of availableServices">
                <td>{{service}}</td>
                <td>
                  <i class="fas fa-check" *ngIf="profile.services.included.includes(service)"></i>
                </td>
                <td>
                  <input type="number" 
                         [(ngModel)]="serviceSelections.extra[service]"
                         (ngModelChange)="handleExtraPriceChange(service, $event)"
                         [value]="serviceSelections.extra[service]"
                         [placeholder]="'Price in ' + rates.currency"
                         min="0">
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div *ngIf="editingState.fieldName === 'services'" class="edit-controls services-edit-grid">
          <table class="services-table">
            <thead>
              <tr>
                <th>Services</th>
                <th>Included</th>
                <th>Extra Price ({{rates.currency}})</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let service of availableServices">
                <td>{{service}}</td>
                <td>
                  <input type="checkbox" 
                         [ngModel]="serviceSelections.included[service]"
                         (change)="handleServiceSelection(service, $event)">
                </td>
                <td>
                  <input type="number" 
                         [(ngModel)]="serviceSelections.extra[service]"
                         (ngModelChange)="handleExtraPriceChange(service, $event)"
                         [value]="serviceSelections.extra[service]"
                         [placeholder]="'Price in ' + rates.currency"
                         min="0">
                </td>
              </tr>
            </tbody>
          </table>
          <div class="edit-buttons">
            <button (click)="saveField('services')" class="save-btn">Save</button>
            <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Physical Attributes -->
    <div class="attributes-section" *ngIf="profile.physicalAttributes">
      <h2>Physical Attributes</h2>
      <div class="attributes-grid">
        <!-- Gender -->
        <div class="attribute editable-field" (click)="startEditing('physicalAttributes.gender')">
          <span class="label">Gender:</span>
          <span *ngIf="editingState.fieldName !== 'physicalAttributes.gender'">
            {{profile.physicalAttributes?.gender || 'Select gender'}}
          </span>
          <div *ngIf="editingState.fieldName === 'physicalAttributes.gender'" class="edit-controls">
            <select [(ngModel)]="editingState.currentValue" required>
              <option value="" disabled selected>Select Gender</option>
              <option value="female">Female</option>
              <option value="male">Male</option>
              <option value="other">Other</option>
            </select>
            <div class="edit-buttons">
              <button [disabled]="!editingState.currentValue" (click)="saveField('physicalAttributes.gender')" class="save-btn">Save</button>
              <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
            </div>
            <small class="error-text" *ngIf="error">{{error}}</small>
          </div>
        </div>

        <!-- Height -->
        <div class="attribute editable-field" (click)="startEditing('physicalAttributes.height')">
          <span class="label">Height:</span>
          <span *ngIf="editingState.fieldName !== 'physicalAttributes.height'">
            {{profile.physicalAttributes.height ? profile.physicalAttributes.height + ' cm' : 'Enter height (140-220 cm)'}}
          </span>
          <div *ngIf="editingState.fieldName === 'physicalAttributes.height'" class="edit-controls">
            <input type="number" 
                   [(ngModel)]="editingState.currentValue" 
                   min="140" 
                   max="220"
                   placeholder="Height in cm">
            <small class="hint-text">Range: 140-220 cm</small>
            <div class="edit-buttons">
              <button (click)="saveField('physicalAttributes.height')" class="save-btn">Save</button>
              <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
            </div>
          </div>
        </div>

        <!-- Weight -->
        <div class="attribute editable-field" (click)="startEditing('physicalAttributes.weight')">
          <span class="label">Weight:</span>
          <span *ngIf="editingState.fieldName !== 'physicalAttributes.weight'">
            {{profile.physicalAttributes.weight ? profile.physicalAttributes.weight + ' kg' : 'Enter weight (35-150 kg)'}}
          </span>
          <div *ngIf="editingState.fieldName === 'physicalAttributes.weight'" class="edit-controls">
            <input type="number" 
                   [(ngModel)]="editingState.currentValue" 
                   min="35" 
                   max="150"
                   placeholder="Weight in kg">
            <small class="hint-text">Range: 35-150 kg</small>
            <div class="edit-buttons">
              <button (click)="saveField('physicalAttributes.weight')" class="save-btn">Save</button>
              <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
            </div>
          </div>
        </div>

        <!-- Ethnicity -->
        <div class="attribute editable-field" (click)="startEditing('physicalAttributes.ethnicity')">
          <span class="label">Ethnicity:</span>
          <span *ngIf="editingState.fieldName !== 'physicalAttributes.ethnicity'">
            {{profile.physicalAttributes.ethnicity || 'Select ethnicity'}}
          </span>
          <div *ngIf="editingState.fieldName === 'physicalAttributes.ethnicity'" class="edit-controls">
            <select [(ngModel)]="editingState.currentValue">
              <option value="">Select Ethnicity</option>
              <option value="Asian">Asian</option>
              <option value="Black">Black</option>
              <option value="Caucasian">Caucasian</option>
              <option value="Hispanic">Hispanic</option>
              <option value="Indian">Indian</option>
              <option value="Middle Eastern">Middle Eastern</option>
              <option value="Mixed">Mixed</option>
              <option value="Other">Other</option>
            </select>
            <div class="edit-buttons">
              <button (click)="saveField('physicalAttributes.ethnicity')" class="save-btn">Save</button>
              <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
            </div>
          </div>
        </div>

        <!-- Bust Size -->
        <div class="attribute editable-field" (click)="startEditing('physicalAttributes.bustSize')">
          <span class="label">Bust Size:</span>
          <span *ngIf="editingState.fieldName !== 'physicalAttributes.bustSize'">
            {{profile.physicalAttributes.bustSize || 'Enter bust size (e.g., 34C)'}}
          </span>
          <div *ngIf="editingState.fieldName === 'physicalAttributes.bustSize'" class="edit-controls">
            <input type="text" 
                   [(ngModel)]="editingState.currentValue" 
                   pattern="[0-9]{2}[A-K]"
                   placeholder="e.g., 34C">
            <small class="hint-text">Format: number + cup size (A-K)</small>
            <div class="edit-buttons">
              <button (click)="saveField('physicalAttributes.bustSize')" class="save-btn">Save</button>
              <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
            </div>
          </div>
        </div>

        <!-- Bust Type -->
        <div class="attribute editable-field" (click)="startEditing('physicalAttributes.bustType')">
          <span class="label">Bust Type:</span>
          <span *ngIf="editingState.fieldName !== 'physicalAttributes.bustType'">
            {{profile.physicalAttributes.bustType || 'Select bust type'}}
          </span>
          <div *ngIf="editingState.fieldName === 'physicalAttributes.bustType'" class="edit-controls">
            <select [(ngModel)]="editingState.currentValue">
              <option value="">Select Bust Type</option>
              <option value="Natural">Natural</option>
              <option value="Enhanced">Enhanced</option>
            </select>
            <div class="edit-buttons">
              <button (click)="saveField('physicalAttributes.bustType')" class="save-btn">Save</button>
              <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
            </div>
          </div>
        </div>

        <!-- Pubic Hair -->
        <div class="attribute editable-field" (click)="startEditing('physicalAttributes.pubicHair')">
          <span class="label">Pubic Hair:</span>
          <span *ngIf="editingState.fieldName !== 'physicalAttributes.pubicHair'">
            {{profile.physicalAttributes?.pubicHair || 'Select style'}}
          </span>
          <div *ngIf="editingState.fieldName === 'physicalAttributes.pubicHair'" class="edit-controls">
            <select [(ngModel)]="editingState.currentValue" required>
              <option value="" disabled selected>Select Style</option>
              <option value="Shaved">Shaved</option>
              <option value="Trimmed">Trimmed</option>
              <option value="Natural">Natural</option>
            </select>
            <div class="edit-buttons">
              <button [disabled]="!editingState.currentValue" (click)="saveField('physicalAttributes.pubicHair')" class="save-btn">Save</button>
              <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
            </div>
            <small class="error-text" *ngIf="error">{{error}}</small>
          </div>
        </div>

        <!-- Tattoos -->
        <div class="attribute editable-field" (click)="startEditing('physicalAttributes.tattoos')">
          <span class="label">Tattoos:</span>
          <span *ngIf="editingState.fieldName !== 'physicalAttributes.tattoos'">
            {{profile.physicalAttributes.tattoos ? 'Yes' : 'No'}}
          </span>
          <div *ngIf="editingState.fieldName === 'physicalAttributes.tattoos'" class="edit-controls">
            <select [(ngModel)]="editingState.currentValue">
              <option [ngValue]="false">No</option>
              <option [ngValue]="true">Yes</option>
            </select>
            <div class="edit-buttons">
              <button (click)="saveField('physicalAttributes.tattoos')" class="save-btn">Save</button>
              <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
            </div>
          </div>
        </div>

        <!-- Piercings -->
        <div class="attribute editable-field" (click)="startEditing('physicalAttributes.piercings')">
          <span class="label">Piercings:</span>
          <span *ngIf="editingState.fieldName !== 'physicalAttributes.piercings'">
            {{profile.physicalAttributes.piercings ? 'Yes' : 'No'}}
          </span>
          <div *ngIf="editingState.fieldName === 'physicalAttributes.piercings'" class="edit-controls">
            <select [(ngModel)]="editingState.currentValue">
              <option [ngValue]="false">No</option>
              <option [ngValue]="true">Yes</option>
            </select>
            <div class="edit-buttons">
              <button (click)="saveField('physicalAttributes.piercings')" class="save-btn">Save</button>
              <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Availability Section -->
    <div class="availability-section" *ngIf="profile.availableToMeet">
      <h2>Availability</h2>
      <div class="availability-details">
        <p *ngIf="profile.availableToMeet.available24_7">Available 24/7</p>
        <p *ngIf="profile.availableToMeet.advanceBooking">Advance Booking Available</p>
        <div *ngIf="profile.availableToMeet.meetingWith.length">
          <h3>Meeting With:</h3>
          <ul>
            <li *ngFor="let meetWith of profile.availableToMeet.meetingWith">{{meetWith}}</li>
          </ul>
        </div>
        <p *ngIf="profile.workingTime">Working Hours: {{profile.workingTime}}</p>
      </div>
    </div>

    <!-- Contact Information -->
    <div class="contact-section">
      <h2>Contact Information</h2>
      <div class="contact-details">
        <div class="contact-item editable-field" (click)="startEditing('contact.phone')">
          <i class="fas fa-phone contact-icon"></i>
          <span class="label">Phone:</span>
          <span *ngIf="editingState.fieldName !== 'contact.phone'" class="value">
            {{profile.contact?.phone || 'Add your phone number'}}
          </span>
          <div *ngIf="editingState.fieldName === 'contact.phone'" class="edit-controls">
            <input type="tel" [(ngModel)]="editingState.currentValue" placeholder="Enter phone number">
            <div class="edit-buttons">
              <button (click)="saveField('contact.phone')" class="save-btn">Save</button>
              <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
            </div>
          </div>
        </div>

        <div class="contact-item editable-field" (click)="startEditing('contact.country')">
          <i class="fas fa-globe contact-icon"></i>
          <span class="label">Country:</span>
          <span *ngIf="editingState.fieldName !== 'contact.country'" class="value">
            {{profile.contact?.country || 'Add your country'}}
          </span>
          <div *ngIf="editingState.fieldName === 'contact.country'" class="edit-controls">
            <input type="text" [(ngModel)]="editingState.currentValue" placeholder="Enter country">
            <div class="edit-buttons">
              <button (click)="saveField('contact.country')" class="save-btn">Save</button>
              <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
            </div>
          </div>
        </div>

        <div class="contact-item editable-field" (click)="startEditing('contact.city')">
          <i class="fas fa-city contact-icon"></i>
          <span class="label">City:</span>
          <span *ngIf="editingState.fieldName !== 'contact.city'" class="value">
            {{profile.contact?.city || 'Add your city'}}
          </span>
          <div *ngIf="editingState.fieldName === 'contact.city'" class="edit-controls">
            <input type="text" [(ngModel)]="editingState.currentValue" placeholder="Enter city">
            <div class="edit-buttons">
              <button (click)="saveField('contact.city')" class="save-btn">Save</button>
              <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
            </div>
          </div>
        </div>

        <div class="contact-item">
          <i class="fas fa-envelope contact-icon"></i>
          <span class="label">Email:</span>
          <span class="value">{{profile.email || 'No email provided'}}</span>
        </div>
      </div>
    </div>

    <!-- Additional Information -->
    <div class="additional-info">
      <div class="rates" *ngIf="rates">
        <h2>Rates</h2>
        <div class="rates-header">
          <select [(ngModel)]="selectedCurrency" (change)="updateCurrency()" *ngIf="isCurrentUser">
            <option value="EUR">EUR</option>
            <option value="USD">USD</option>
            <option value="GBP">GBP</option>
          </select>
        </div>
        <table class="rates-table">
          <thead>
            <tr>
              <th>Duration</th>
              <th>Incall</th>
              <th>Outcall</th>
              <th *ngIf="isCurrentUser">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let duration of getRateDurations()">
              <td>{{duration}}</td>
              <td class="editable-field" (click)="startEditing('rates.incall.' + duration)">
                <span *ngIf="editingState.fieldName !== 'rates.incall.' + duration">
                  {{ rates.incall[duration] ? rates.incall[duration] + ' ' + (rates.currency || 'EUR') : 'N/A' }}
                </span>
                <div *ngIf="editingState.fieldName === 'rates.incall.' + duration" class="edit-controls">
                  <input type="number" [(ngModel)]="editingState.currentValue" placeholder="Enter rate" min="0">
                  <div class="edit-buttons">
                    <button (click)="saveField('rates.incall.' + duration)" class="save-btn">Save</button>
                    <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
                  </div>
                </div>
              </td>
              <td class="editable-field" (click)="startEditing('rates.outcall.' + duration)">
                <span *ngIf="editingState.fieldName !== 'rates.outcall.' + duration">
                  {{ rates.outcall[duration] ? rates.outcall[duration] + ' ' + (rates.currency || 'EUR') : 'N/A' }}
                </span>
                <div *ngIf="editingState.fieldName === 'rates.outcall.' + duration" class="edit-controls">
                  <input type="number" [(ngModel)]="editingState.currentValue" placeholder="Enter rate" min="0">
                  <div class="edit-buttons">
                    <button (click)="saveField('rates.outcall.' + duration)" class="save-btn">Save</button>
                    <button (click)="$event.stopPropagation(); cancelEditing()" class="cancel-btn">Cancel</button>
                  </div>
                </div>
              </td>
              <td *ngIf="isCurrentUser">
                <button class="delete-btn" (click)="deleteRate(duration)"><i class="fas fa-trash"></i></button>
              </td>
            </tr>
          </tbody>
        </table>
        <div *ngIf="isCurrentUser" class="add-rate-section">
          <input type="text" [(ngModel)]="newDuration" placeholder="Duration (e.g., '2 Hours')">
          <button (click)="addNewRate()" class="add-btn">Add Rate</button>
        </div>
      </div>
    </div>
  </div>


  <!-- Add this at the bottom of your component -->
  <div class="image-modal" *ngIf="selectedImage" (click)="closeImageModal()">
    <div class="modal-content">
      <span class="close-button" (click)="closeImageModal()">&times;</span>
      <img [src]="selectedImage" alt="Full size image">
    </div>
  </div>
</div>
