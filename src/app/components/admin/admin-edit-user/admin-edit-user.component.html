<div class="edit-container">
  <h2>Edit User Profile</h2>
  <div *ngIf="isLoading">Loading...</div>
  <div *ngIf="error" class="error-message">{{error}}</div>
  <div *ngIf="successMessage" class="success-message">{{successMessage}}</div>
  
  <form *ngIf="userForm" [formGroup]="userForm" (ngSubmit)="onSubmit()">
    <div class="form-section">
      <h3>Basic Information</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>Username</label>
          <input type="text" formControlName="username" readonly>
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" formControlName="email" readonly>
        </div>
        <div class="form-group">
          <label>Birthdate</label>
          <input type="date" formControlName="birthdate" readonly>
        </div>
        <div class="form-group">
          <label>Verified</label>
          <select formControlName="verified">
            <option [ngValue]="true">Yes</option>
            <option [ngValue]="false">No</option>
          </select>
        </div>
        <div class="form-group">
          <label>Status</label>
          <select formControlName="status">
            <option value="active">Active</option>
            <option value="suspended">Suspended</option>
            <option value="pending">Pending</option>
          </select>
        </div>
        <div class="form-group">
          <label>Profile Level</label>
          <select formControlName="profileLevel">
            <option value="free">Free</option>
            <option value="standard">Standard</option>
            <option value="premium">Premium</option>
            <option value="vip">VIP</option>
          </select>
        </div>
        <div class="form-group">
          <label>Verification Status</label>
          <select formControlName="verificationStatus">
            <option value="unverified">Unverified</option>
            <option value="pending">Pending</option>
            <option value="reviewing">Reviewing</option>
            <option value="verified">Verified</option>
            <option value="rejected">Rejected</option>
          </select>
        </div>
      </div>
    </div>

    <div class="form-section" formGroupName="physicalAttributes">
      <h3>Physical Attributes</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>Gender</label>
          <select formControlName="gender">
            <option value="female">Female</option>
            <option value="male">Male</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div class="form-group">
          <label>Height (cm)</label>
          <input type="number" formControlName="height">
        </div>
        <div class="form-group">
          <label>Weight (kg)</label>
          <input type="number" formControlName="weight">
        </div>
        <div class="form-group">
          <label>Ethnicity</label>
          <input type="text" formControlName="ethnicity">
        </div>
        <div class="form-group">
          <label>Bust Size</label>
          <input type="text" formControlName="bustSize">
        </div>
        <div class="form-group">
          <label>Bust Type</label>
          <select formControlName="bustType">
            <option value="Natural">Natural</option>
            <option value="Enhanced">Enhanced</option>
          </select>
        </div>
        <div class="form-group">
          <label>Pubic Hair</label>
          <select formControlName="pubicHair">
            <option value="Shaved">Shaved</option>
            <option value="Trimmed">Trimmed</option>
            <option value="Natural">Natural</option>
          </select>
        </div>
        <div class="form-group">
          <label>Features</label>
          <div class="checkbox-group">
            <label>
              <input type="checkbox" formControlName="tattoos"> Has Tattoos
            </label>
            <label>
              <input type="checkbox" formControlName="piercings"> Has Piercings
            </label>
          </div>
        </div>
      </div>
    </div>

    <div class="form-section">
      <h3>Media</h3>
      <div class="media-grid">
        <div class="media-section">
          <h4>Profile Picture</h4>
          <img *ngIf="profile?.profilePicture" 
               [src]="getMediaUrl(profile?.profilePicture!)" 
               alt="Profile" 
               (click)="openPreview(profile?.profilePicture!)">
        </div>
        <div class="media-section">
          <h4>Images ({{profile?.images?.length || 0}})</h4>
          <div class="image-grid">
            <div *ngFor="let image of profile?.images" class="image-item">
              <img [src]="getMediaUrl(image)" alt="Gallery" (click)="openPreview(image)">
            </div>
          </div>
        </div>
        <div class="media-section">
          <h4>Videos ({{profile?.videos?.length || 0}})</h4>
          <div class="video-grid">
            <div *ngFor="let video of profile?.videos" class="video-item">
              <video [src]="getMediaUrl(video)" controls></video>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="form-section">
      <h3>Verification</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>Verification Status</label>
          <select formControlName="verificationStatus">
            <option value="unverified">Unverified</option>
            <option value="pending">Pending</option>
            <option value="verified">Verified</option>
            <option value="rejected">Rejected</option>
          </select>
        </div>
        <div class="media-section" *ngIf="profile?.verificationDocuments && profile?.verificationDocuments.length > 0">
          <h4>Verification Documents</h4>
          <div class="doc-grid">
            <div *ngFor="let doc of profile?.verificationDocuments" class="doc-item">
              <p><strong>{{ doc.side === 'front' ? 'ID Front' : (doc.side === 'back' ? 'ID Back' : 'Document') }}</strong></p>
              <img [src]="getMediaUrl(doc.data)" 
                   alt="Verification document {{doc.side}}" 
                   (click)="openPreview(doc.data)"
                   style="max-width: 300px; cursor: pointer; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 5px;">
              <p><small>Uploaded: {{ doc.uploadedAt | date:'medium' }}</small></p>
            </div>
          </div>
          <div class="verification-actions">
            <button type="button" class="btn btn-success" 
                    (click)="approveVerification()"
                    [disabled]="isProcessingVerification || profile?.verificationStatus === 'verified' || profile?.verificationStatus === 'rejected'">
              {{ isProcessingVerification ? 'Processing...' : 'Approve Verification' }}
            </button>
            <button type="button" class="btn btn-danger" 
                    (click)="rejectVerification()"
                    [disabled]="isProcessingVerification || profile?.verificationStatus === 'verified' || profile?.verificationStatus === 'rejected'">
              {{ isProcessingVerification ? 'Processing...' : 'Reject Verification' }}
            </button>
          </div>
        </div>
        <div *ngIf="!profile?.verificationDocuments || profile?.verificationDocuments.length === 0" class="no-documents-message">
          <p>No verification documents uploaded.</p>
        </div>
      </div>
    </div>

    <div class="form-section" formGroupName="subscription">
      <h3>Subscription</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>Active</label>
          <select formControlName="active">
            <option [ngValue]="true">Yes</option>
            <option [ngValue]="false">No</option>
          </select>
        </div>
        <div class="form-group">
          <label>Plan</label>
          <select formControlName="plan">
            <option value="basic">Basic</option>
            <option value="premium">Premium</option>
            <option value="vip">VIP</option>
          </select>
        </div>
        <div class="form-group">
          <label>Start Date</label>
          <input type="date" formControlName="startDate">
        </div>
        <div class="form-group">
          <label>End Date</label>
          <input type="date" formControlName="endDate">
        </div>
      </div>
    </div>

    <div class="form-section" formGroupName="moderationFlags">
      <h3>Moderation</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>Content Warnings</label>
          <textarea formControlName="contentWarnings" rows="3"></textarea>
        </div>
        <div class="form-group">
          <label>Reviewer Notes</label>
          <textarea formControlName="reviewerNotes" rows="3"></textarea>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" [disabled]="userForm.invalid || isSaving">
        {{isSaving ? 'Saving...' : 'Save Changes'}}
      </button>
      <button type="button" class="cancel-btn" (click)="onCancel()">Cancel</button>
    </div>
  </form>
</div>

<div *ngIf="previewUrl" class="preview-overlay" (click)="closePreview()">
  <div class="preview-content">
    <img [src]="previewUrl" alt="Preview">
  </div>
</div>